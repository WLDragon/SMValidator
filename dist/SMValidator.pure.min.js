/*!
 * SMValidator 1.2.7
 * Copyright (c) 2016 WLDragon(cwloog@qq.com)
 * Released under the MIT License.
 */!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.SMValidator=t()}(this,function(){"use strict";function e(e,t,r){c?e.attachEvent("on"+t,r):e.addEventListener(t,r)}function t(e){return"checkbox"===e||"radio"===e}function r(e){return"string"==typeof e}function n(e,t){return d.call(e,t)}function s(e,t){var r=this;t||(t={});for(var s=m.length-1;s>=0;s--){var a=m[s];r[a]=n(t,a)?t[a]:b[a]}if(r.fields={},r.rules=t.rules||{},e){r.submit=t.submit;for(var i in t.fields)r.fields[i]=r.parseField(t.fields[i]);r.queryInput(e)}}function a(e,t){if(e)for(var r=e.length-1;r>=0;r--){for(var n=e[r],s=n.target,a=n.className.split(" "),i=s.className?s.className.split(" "):[],l=a.length-1;l>=0;l--){var u=a[l],o=i.indexOf(u);!t&&o>-1?i.splice(o,1):t&&o===-1&&i.push(u)}s.className=i.join(" ")}}function i(e,t,r){if(e)for(var n=e.length-1;n>=0;n--){var s=e[n];s.keep?t||s.quiet||(s.dom.innerHTML=""):s.dom.style.display=t?"":"none",r&&!s.quiet&&(s.dom.innerHTML=r)}}function l(e,t){if(t)for(var r in t)e.style[r]=t[r]}function u(e){var t=e._sm;l(e,t.style),i(t.failHtml,!1),i(t.passHtml,!1),a(t.failCss,!1),a(t.passCss,!1)}function o(e,r){var n=e.type,s=e.name,o=e._sm,f=o.rule,c=!0,p=[],d=1,m="",g="|"===f.token;if(t(n)&&e.form)for(var h=e.form.elements[s],v=h.length-1;v>=0;v--)h[v].checked&&(m+=" ");else if("select-multiple"===n)for(var h=e.children,v=h.length-1;v>=0;v--)h[v].selected&&h[v].value&&(m+=" ");else m=e.value;if(r&&"number"==typeof r.forceFlag)d=r.forceFlag,f.async&&(o.asyncFlag=d,r.asyncMessage&&(o.asyncMessage=r.asyncMessage),2===d&&(c=o.asyncMessage||"no asyncMessage!"));else if(f.async)f.required&&!m?(d=2,c=f.required):"number"==typeof o.asyncFlag?(d=o.asyncFlag,2===d&&(c=o.asyncMessage||"no asyncMessage!")):m?(d=2,c=f.async):d=0;else if(m)for(var v=f.rules.length-1;v>=0;v--){var b=f.rules[v],S=b.rule;if(S instanceof RegExp){if(!S.test(m)){if(c=b.message,d=2,g)break;p.push(c)}}else if(c=b.params?S.apply(null,[m].concat(b.params)):S.call(null,m),c!==!0){if(d=2,g)break;p.push(c)}}else f.required?(d=2,c=f.required,g||p.push(c)):d=0;return g||(d=p.length?2:1),u(e),1===d?(a(o.failCss,!1),a(o.passCss,!0),l(e,f.passStyle),i(o.passHtml,!0),f.pass&&f.pass.call(e)):2===d&&(a(o.passCss,!1),a(o.failCss,!0),l(e,f.failStyle),i(o.failHtml,!0,g?c:p.join("<br/>")),f.fail&&f.fail.call(e,g?c:p)),2===d&&y&&(e.scrollIntoView(),y=!1),2!==d}var f=window.document,c=!f.addEventListener;if(c)Array.prototype.indexOf=function(e){for(var t=0,r=this.length;t<r;t++)if(this[t]===e)return t;return-1},Object.defineProperty(Element.prototype,"nextElementSibling",{get:function(){for(var e=this.nextSibling;e&&1!==e.nodeType;)e=e.nextSibling;return e}});else{var p=!0;f.addEventListener("compositionstart",function(e){p=!1}),f.addEventListener("compositionend",function(e){p=!0;var t=f.createEvent("HTMLEvents");t.initEvent("input",!0,!0),e.target.dispatchEvent(t)}),f.addEventListener("input",function(e){if(p){var t=e.target;t._sm&&!t._sm.rule.disinput&&o(t)}})}e(f,"change",function(e){var r=e.target;t(r.type)&&r._sm&&!r._sm.rule.manul&&o(r)});var d=Object.prototype.hasOwnProperty,m=["required","async","short","disinput","disblur","focus","manul","failHtml","passHtml","failStyle","failCss","passStyle","passCss"],g=m.slice(3),h=s.prototype;h.queryInput=function(t){for(var r=this,n=[],a=f.querySelectorAll(t),i=a.length-1;i>=0;i--){var l=a[i],u=l.tagName;if("FORM"===u){l.novalidate="novalidate";for(var o=[],c=l.length-1;c>=0;c--)r.bindInput(l[c])&&o.push(l[c]);n=n.concat(o),r.submit&&o.length&&(l._smInputs=o,e(l,"submit",function(e){e.preventDefault();var t=e.target||e.srcElement,n=s.validate(t._smInputs,{locate:!0,"short":r["short"]});r.submit(n,t)}))}else"INPUT"!==u&&"SELECT"!==u&&"TEXTAREA"!==u||r.bindInput(l)&&n.push(l)}return n},h.bindInput=function(r){if(r._sm)return!0;var s=this,a=r.getAttribute("name"),i=r.getAttribute("data-rule"),l=i?this.parseString(i):this.fields[a];if(l){if(r._sm={rule:l,flag:0},!l._isInit){l._isInit=!0,s.handleProperty(l,"required"),s.handleProperty(l,"async"),l.async&&(l.manul=!0);for(var p=g.length-1;p>=0;p--){var d=g[p];n(l,d)||(l[d]=this[d])}s.handleStyle(l,"failStyle"),s.handleStyle(l,"passStyle")}s.recordStyle(r,l.failStyle),s.recordStyle(r,l.passStyle);var m=r._sm;if(t(r.type)){for(var h=f.querySelectorAll('input[name="'+a+'"]'),p=h.length-1;p>=0;p--)h[p]!==r&&(h[p]._sm=m);l.disblur=l.disinput=!0,l.focus=!1}else r.style.borderImage||(m.style||(m.style={}),m.style.borderImage="");return s.handleHtml(r,"failHtml",l),s.handleHtml(r,"passHtml",l),s.handleCss(r,"failCss",l.failCss),s.handleCss(r,"passCss",l.passCss),l.manul&&(l.disblur=l.disinput=!0),l.focus&&e(r,"focus",function(e){u(e.target||e.srcElement)}),l.disblur||e(r,"blur",function(e){o(e.target||e.srcElement)}),c&&!l.disinput&&r.attachEvent("onpropertychange",function(e){"value"===e.propertyName&&o(e.srcElement)}),!0}return!1},h.handleProperty=function(e,t){n(e,t)?e[t]===!0&&(e[t]=this[t]):e[t]=!1},h.handleStyle=function(e,t){if(r(e[t]))try{e[t]=JSON.parse(e[t].replace(/'/g,'"'))}catch(n){console.error("error json format: "+e[t])}},h.recordStyle=function(e,t){if(t){e._sm.style||(e._sm.style={});var r=e._sm.style;for(var n in t)r[n]||(r[n]=e.style[n])}},h.handleHtml=function(e,t,n){var s=n[t];if(s){e._sm[t]=[],r(s)&&(s=[s]);for(var a=0;a<s.length;a++){var i,l=s[a],u={};if(0===l.indexOf("*")&&(l=l.substring(1),u.keep=!0),0===l.indexOf("!")&&(l=l.substring(1),u.quiet=!0),l.indexOf("<")>-1){for(var o=e;0===l.indexOf("+");)l=l.substring(1),o=o.parentNode;var c=f.createElement("div");c.innerHTML=l,i=c.children[0],o.parentNode.insertBefore(i,o.nextElementSibling)}else i=f.querySelector(l);i&&(u.dom=i,e._sm[t].push(u),u.keep||(i.style.display="none"))}}},h.handleCss=function(e,t,n){if(n){r(n)&&(n=[n]),e._sm[t]=[];for(var s=n.length-1;s>=0;s--){for(var a=n[s],i=e;0===a.indexOf("+");)a=a.substring(1),i=i.parentNode;e._sm[t].push({target:i,className:a})}}},h.parseRule=function(e,t){var r=e.name,n=this.rules[r]||b.rules[r];n&&(n instanceof Array?t.rules.push({rule:n[0],message:n[1]}):t.rules.push({rule:n,params:e.params}))},h.parseStringFunction=function(e){var t={name:e},r=e.indexOf("(");return r>0&&(t.name=e.substring(0,r),e.indexOf("{")>-1?t.params=e.substring(r+1,e.length-1):t.params=e.substring(r+1,e.length-1).split(",")),t},h.parseString=function(e){var t={rules:[]},r=e.indexOf("&")>-1?"&":"|",n=e.split(r);t.token=r;for(var s=n.length-1;s>=0;s--){var a=n[s];if(a)if(0===a.indexOf("/")){var i=a.substring(1).split("/");2===i.length?t.rules.push({rule:new RegExp(i[0]),message:i[1]}):3===i.length&&t.rules.push({rule:new RegExp(i[0],"i"),message:i[2]})}else{var l=this.parseStringFunction(a),u=l.name,o=!0;if("!"===u.charAt(0)&&(u=u.substring(1),o=!1),m.indexOf(u)>-1){var f=l.params;f?t[u]=f:t[u]=o}else this.parseRule(l,t)}}return t},h.parseField=function(e){if(e instanceof Array)return{rules:[{rule:e[0],message:e[1]}]};if(e instanceof Function)return{rules:[{rule:e}]};if(r(e))return this.parseString(e);if("object"==typeof e){if(e.token="|",e.rule instanceof Array)e.rules=[{rule:e.rule[0],message:e.rule[1]}];else if(e.rule instanceof Function)e.rules=[{rule:e.rule}];else if(r(e.rule)){var t=e.rule;delete e.rule,t.indexOf("&")>-1&&(e.token="&");var n=t.split(e.token);e.rules=[];for(var s=n.length-1;s>=0;s--)n[s]&&this.parseRule(this.parseStringFunction(n[s]),e)}return e}};var v,y,b={async:"not been validated by async",required:"this is required",rules:{}};return s.config=function(e){for(var t=m.length-1;t>=0;t--){var r=m[t];n(e,r)&&(b[r]=e[r])}if(e.rules)for(var a in e.rules)b.rules[a]=e.rules[a];v=new s},s.validate=function(e,t){var n=r(e)?v.queryInput(e):e,s=0,a=0,i=!1;t&&(y=t.locate,i=t["short"]);for(var l=n.length-1;l>=0;l--){var u=n[l];if(u._sm)if(a++,o(u,t))s++;else if(i)return!1}return a===s},s.reset=function(e){for(var t=r(e)?v.queryInput(e):e,n=t.length-1;n>=0;n--)u(t[n])},s});